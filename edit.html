<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sales History</title>
<style>
  body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
  h2 { margin-bottom: 15px; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
  tr:nth-child(even) { background: #f2f2f2; }
  #backBtn { margin-top: 20px; padding: 10px 15px; background: gray; color: white; border: none; border-radius: 4px; cursor: pointer; }
  #backBtn:hover { background: #555; }
</style>
</head>
<body>

<h2>Sales History</h2>

<table id="salesTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Product</th>
      <th>Quantity</th>
      <th>Total Price</th>
      <th>Profit</th>
    </tr>
  </thead>
  <tbody>
    <!-- البيانات رح تظهر هون -->
  </tbody>
</table>

<button id="backBtn">Back to Sales</button>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC-UjeJiOP2-hlD6gAQTKAUL_E_Ns5y0x0",
    authDomain: "store-64757.firebaseapp.com",
    projectId: "store-64757",
    storageBucket: "store-64757.firebasestorage.app",
    messagingSenderId: "240047001550",
    appId: "1:240047001550:web:ed9577c48a975d11b7e59f",
    measurementId: "G-FENZRL8FSF"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const salesTableBody = document.querySelector('#salesTable tbody');
  const backBtn = document.getElementById('backBtn');

  let user;

  backBtn.onclick = () => {
    window.location.href = "index.html";
  };

  auth.onAuthStateChanged(async (usr) => {
    if (usr) {
      user = usr;
      loadSales();
    } else {
      window.location.href = "index.html";
    }
  });

  async function loadSales() {
    salesTableBody.innerHTML = '<tr><td colspan="5">Loading sales...</td></tr>';

    try {
      const salesSnapshot = await db.collection('users').doc(user.uid).collection('sales').orderBy('date', 'desc').get();
      if (salesSnapshot.empty) {
        salesTableBody.innerHTML = '<tr><td colspan="5">No sales found.</td></tr>';
        return;
      }

      salesTableBody.innerHTML = '';
      salesSnapshot.forEach(doc => {
        const sale = doc.data();
        const date = sale.date ? new Date(sale.date.seconds * 1000).toLocaleDateString() : '';
        const product = sale.product || '';
        const quantity = sale.quantity || 0;
        const totalPrice = sale.totalPrice || 0;
        const profit = sale.profit || 0;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${date}</td>
          <td>${product}</td>
          <td>${quantity}</td>
          <td>${totalPrice.toFixed(2)}</td>
          <td>${profit.toFixed(2)}</td>
        `;
        salesTableBody.appendChild(row);
      });
    } catch (error) {
      salesTableBody.innerHTML = `<tr><td colspan="5">Error loading sales: ${error.message}</td></tr>`;
    }
  }
</script>

</body>
</html>
