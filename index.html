<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Store Sales</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:0;
    background: #f0f0f0;
    color: #222;
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background: #222;
    color: #eee;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #b00;
    color: white;
    padding: 10px 20px;
  }
  #menuBtn {
    font-size: 24px;
    cursor: pointer;
    user-select: none;
  }
  #menu {
    display: none;
    position: absolute;
    top: 50px;
    right: 20px;
    background: white;
    border: 1px solid #ccc;
    border-radius: 5px;
    overflow: hidden;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
  }
  #menu.dark {
    background: #333;
    color: white;
    border-color: #555;
  }
  #menu button {
    display: block;
    width: 150px;
    border: none;
    background: none;
    padding: 10px;
    cursor: pointer;
    font-size: 16px;
    text-align: left;
  }
  #menu button:hover {
    background: #eee;
  }
  #menu.dark button:hover {
    background: #555;
  }
  main {
    padding: 20px;
    max-width: 400px;
    margin: 20px auto;
    background: white;
    border-radius: 8px;
  }
  main.dark {
    background: #333;
  }
  label {
    display: block;
    margin: 15px 0 5px;
  }
  select, input[type=number] {
    width: 100%;
    padding: 8px;
    font-size: 16px;
  }
  #totalPrice {
    margin-top: 15px;
    font-size: 18px;
    font-weight: bold;
  }
  button#logoutBtn {
    margin-top: 20px;
    padding: 10px;
    width: 100%;
    font-size: 16px;
    background: #b00;
    border: none;
    color: white;
    border-radius: 5px;
    cursor: pointer;
  }
  button#logoutBtn:hover {
    background: #900;
  }
</style>
</head>
<body>

<header>
  <div>Store Sales</div>
  <div id="menuBtn">&#x22EE;</div>
  <div id="menu">
    <button id="toggleDark">Toggle Dark Mode</button>
    <button id="editPrices">Edit Prices</button>
    <button id="viewSales">View Sales</button>
    <button id="logoutBtn">Logout</button>
  </div>
</header>

<main>
  <h2>Welcome, <span id="userName">Guest</span></h2>

  <label for="productSelect">Select Product</label>
  <select id="productSelect"></select>

  <label for="quantityInput">Quantity</label>
  <input type="number" id="quantityInput" min="1" value="1" />

  <div id="totalPrice">Total Price: 0</div>

  <button id="saveSaleBtn" style="margin-top:20px; padding:10px; width:100%; font-size:16px;">Save Sale</button>
</main>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC-UjeJiOP2-hlD6gAQTKAUL_E_Ns5y0x0",
    authDomain: "store-64757.firebaseapp.com",
    projectId: "store-64757",
    storageBucket: "store-64757.firebasestorage.app",
    messagingSenderId: "240047001550",
    appId: "1:240047001550:web:ed9577c48a975d11b7e59f",
    measurementId: "G-FENZRL8FSF"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Elements
  const menuBtn = document.getElementById('menuBtn');
  const menu = document.getElementById('menu');
  const toggleDarkBtn = document.getElementById('toggleDark');
  const editPricesBtn = document.getElementById('editPrices');
  const viewSalesBtn = document.getElementById('viewSales');
  const logoutBtn = document.getElementById('logoutBtn');
  const userNameSpan = document.getElementById('userName');
  const productSelect = document.getElementById('productSelect');
  const quantityInput = document.getElementById('quantityInput');
  const totalPriceDiv = document.getElementById('totalPrice');
  const saveSaleBtn = document.getElementById('saveSaleBtn');
  const mainSection = document.querySelector('main');

  let user = null;
  let prices = {}; // { productName: { price: number, cost: number } }

  // Toggle menu
  menuBtn.addEventListener('click', () => {
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    if (document.body.classList.contains('dark')) {
      menu.classList.add('dark');
    } else {
      menu.classList.remove('dark');
    }
  });

  // Toggle dark mode
  toggleDarkBtn.addEventListener('click', () => {
    document.body.classList.toggle('dark');
    mainSection.classList.toggle('dark');
    menu.classList.toggle('dark');
    menu.style.display = 'none';
  });

  // Redirect buttons
  editPricesBtn.addEventListener('click', () => {
    window.location.href = "prices.html";
  });
  viewSalesBtn.addEventListener('click', () => {
    window.location.href = "sales.html";
  });
  logoutBtn.addEventListener('click', () => {
    auth.signOut();
  });

  // Calculate total price and profit
  function updateTotal() {
    const product = productSelect.value;
    const qty = Number(quantityInput.value);
    if (!product || !prices[product] || qty < 1) {
      totalPriceDiv.textContent = 'Total Price: 0';
      return;
    }
    const price = prices[product].price;
    const cost = prices[product].cost;
    const total = price * qty;
    const profit = (price - cost) * qty;
    totalPriceDiv.textContent = `Total Price: ${total.toFixed(2)} (Profit: ${profit.toFixed(2)})`;
  }

  productSelect.addEventListener('change', updateTotal);
  quantityInput.addEventListener('input', updateTotal);

  // Load prices from Firestore for current user
  async function loadPrices() {
    if (!user) return;
    try {
      const doc = await db.collection('users').doc(user.uid).collection('prices').doc('default').get();
      if (doc.exists) {
        prices = doc.data();
        // fill select options
        productSelect.innerHTML = '';
        Object.keys(prices).forEach(product => {
          const opt = document.createElement('option');
          opt.value = product;
          opt.textContent = product;
          productSelect.appendChild(opt);
        });
        updateTotal();
      } else {
        productSelect.innerHTML = '<option value="">No products</option>';
      }
    } catch (err) {
      console.error('Error loading prices:', err);
    }
  }

  // Save sale data to Firestore
  async function saveSale() {
    if (!user) return alert('User not logged in');
    const product = productSelect.value;
    const qty = Number(quantityInput.value);
    if (!product) return alert('Select a product');
    if (qty < 1) return alert('Enter valid quantity');
    const price = prices[product].price;
    const cost = prices[product].cost;
    const total = price * qty;
    const profit = (price - cost) * qty;
    const saleData = {
      product,
      quantity: qty,
      totalPrice: total,
      profit,
      date: firebase.firestore.Timestamp.now()
    };
    try {
      await db.collection('users').doc(user.uid).collection('sales').add(saleData);
      alert('Sale saved!');
      quantityInput.value = '1';
      updateTotal();
    } catch (err) {
      alert('Error saving sale:
